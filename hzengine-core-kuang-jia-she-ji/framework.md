# 概览

## 角色定义

* 创作者：使用HZengine创作galgame的人

## 框架设计

设计目标：精简核心功能，保证初始版本代码量低，以快速实现出初始版本和demo。减少以后扩展功能的技术债务

HZengine Core 分为多个模块实现

* ui: 界面模块，负责页面的组织和显示。不依赖具体的 UI 框架、不内置转场和过渡功能，仅仅是调用创作者提供的页面创建和销毁函数，由创作者实现具体的绘制逻辑。
* audio: 音频模块，负责 bgm，voice，音效的混音和播放（暂时先封装单轨音频播放的逻辑，混音等华米的系统能力开放后实现）
* system: 系统模块，负责游戏整体运行逻辑，如状态管理
* storage: 存储模块，负责存档的存取、代理文件系统、加解密(按需实现)、hmg 映像（类似 krkr 的.xp3，用来将游戏资源打包成一个文件，按需实现）
* script: 剧本解释器模块，负责解释和优化.ksz 剧本，提供自定义语法功能
* debug: 调试模块，异常处理、日志
* async: 异步模块，负责管理定时器、执行异步任务等
* agnostic: 跨平台模块，封装使 HZengine 跨平台运行的最小接口。HZengine Core 不包含任何特定平台代码，而必须通过 agnostic 模块间接访问，或是从 HZengine 中剔除

至于网络和健康传感器等功能，可以先自己调用，时机成熟后开发内置模块



### hz.audio 音频模块

`hz.audio` 将音频系统抽象为多个不同的通道(channel)，比如

* `voice` 播放角色录音的通道
* `music` 播放bgm的通道
* `sound` 播放音效的通道

每个通道同一时间只允许一段音频播放。多个通道同时播放时，需要混音来叠加声音。由于ZeppOS没有提供相关能力，因此在ZeppOS上暂时只能有一个通道，这意味着不能同时播放bgm和人物配音

每个通道包含一个待播放音频队列(queue)，并允许设置不同的播放模式，如`repeat(单曲循环)`, `order(顺序播放)`, `list_loop(列表循环)`

音频资源的寻址交给hz.storage实现，而hz.storage通过hz.agnostic访问文件系统；音频的播放和混音具体逻辑和状态控制、回调由hz.agnostic实现

